/*══════════════════════════════════════════════════════════════════════════════════════════════╗
                                                                                                ║
                    ███████╗ ██████╗ █████╗ ██████╗  █████╗ ██████╗                             ║
                    ██╔════╝██╔════╝██╔══██╗██╔══██╗██╔══██╗██╔══██╗                            ║
                    ███████╗██║     ███████║██████╔╝███████║██████╔╝                            ║
                    ╚════██║██║     ██╔══██║██╔══██╗██╔══██║██╔══██╗                            ║
                    ███████║╚██████╗██║  ██║██║  ██║██║  ██║██████╔╝                            ║
                    ╚══════╝ ╚═════╝╚═╝  ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝╚═════╝                             ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╣           */

#include "quantum.h"
#include "pharaoh.h"

enum _layers { _INSERT, _NAVIGATE, _NUMBERS, _FUNCTION, _MACRO, _MEDIA, _INVERT, _MOUSE, _RAWHID, _VIEWING };

// key aliases
#include "aliases.h"

#ifdef LOGGING_ENABLE
#include "feature/log/log.h"
#endif

/*══════════════════════════════════════════════════════════════════════════════════════════════╣
                         ___  ___  ___  ___  _ _  ___  ___  ___                                 ║
                        | __>| __>| . ||_ _|| | || . \| __>/ __>                                ║
                        | _> | _> |   | | | | ' ||   /| _> \__ \                                ║
                        |_|  |___>|_|_| |_| `___'|_\_\|___><___/                                ║
                                                                                                ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╣           */

#include "feature/feature_manager.h"

#ifdef COMBO_ENABLE
#include "feature/combos/keymap_combo.h"
#endif

#ifdef SWAP_HANDS_ENABLE
#include "feature/swap_hands/swap_hands.h"
#endif

#ifdef OS_DETECTION_ENABLE
#include "feature/os_detect/os_detect.h"
#endif

#ifdef LEADER_MULTIKEY
#include "feature/leader_key/leader_multikey.h"
#endif
#ifdef LEADER_SCANMOD
#include "feature/leader_key/leader_scanmod.h"
#endif
#ifdef LEADER_HASH
#include "feature/leader_key/leader_hash.h"
#endif

#ifdef HID_CONTROLLER_ENABLE
#include "feature/raw_hid/rawhid_controller.h"
#endif

#ifdef MOD_KEYS_ENABLE
#include "feature/mod_keys/mod_keys.h"
#endif

#ifdef COUNTER_KEYS_ENABLE
#include "feature/counter_keys/counter_keys.h"
#endif

void raw_hid_receive_user(uint8_t *data, uint8_t length);

void keyboard_post_init_user(void) {
#ifdef LOGGING_ENABLE
    log_init();
#endif
#ifdef HID_CONTROLLER_ENABLE
    set_raw_hid_receive_callback(raw_hid_receive_user);
#endif
}


/*══════════════════════════════════════════════════════════════════════════════════════════════╣
                ___  ___  ___  ___  ___  ___  ___   ___  ___  ___  ___  ___  ___                ║
               | . \| . \| . ||  _>| __>/ __>/ __> | . \| __>|  _>| . || . \| . \               ║
               |  _/|   /| | || <__| _> \__ \\__ \ |   /| _> | <__| | ||   /| | |               ║
               |_|  |_\_\`___'`___/|___><___/<___/ |_\_\|___>`___/`___'|_\_\|___/               ║
                                                                                                ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╣           */
bool process_record_user(uint16_t keycode, keyrecord_t* record) {
#ifdef FEATURE_KEYS_ENABLE
    if (!process_record_feature(keycode, record)) {
        write_log_format(LOG_LEVEL_INFO, "%5u; process_record_feature: 0x%04X %s", record->event.time, keycode, record->event.pressed ? "pressed" : "released");
        return false;
    }
#endif
#ifdef MOD_KEYS_ENABLE
    if (!process_record_mod_keys(keycode, record)){
        write_log_format(LOG_LEVEL_INFO, "%5u; process_record_mod_keys: 0x%04X %s\n", record->event.time, keycode, record->event.pressed ? "pressed" : "released");
        return false;
    }
#endif
#ifdef HID_CONTROLLER_ENABLE
    if (!process_record_raw_hid(keycode, record)) {
        write_log_format(LOG_LEVEL_INFO, "%5u; process_record_raw_hid: 0x%04X %s\n", record->event.time, keycode, record->event.pressed ? "pressed" : "released");
        return false;
    }
#endif
#ifdef LEADER_MULTIKEY
    if (!process_record_leader(keycode, record)) {
        write_log_format(LOG_LEVEL_INFO, "%5u; process_record_leader: 0x%04X %s\n", record->event.time, keycode, record->event.pressed ? "pressed" : "released");
        return false;
    }
#endif
#ifdef OS_DETECTION_ENABLE
    if (!process_record_os(keycode, record)) {
        write_log_format(LOG_LEVEL_INFO, "%5u; process_record_os: 0x%04X %s\n", record->event.time, keycode, record->event.pressed ? "pressed" : "released");
        return false;
    }
#endif
    return true;
}

#ifdef HID_CONTROLLER_ENABLE
void raw_hid_receive_user(uint8_t *data, uint8_t length) {

}
#endif

/*══════════════════════════════════════════════════════════════════════════════════════════════╣
                             _ __ ___  _ _  __ __  ___  ___  ___                                ║
                            | / /| __>| | ||  \  \| . || . \/ __>                               ║
                            |  \ | _> \   /|     ||   ||  _/\__ \                               ║
                            |_\_\|___> |_| |_|_|_||_|_||_|  <___/                               ║
                                                                                                ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╣           */

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

/*══════════════════════════════════════════════════════════════════════════════════════════════╣           */
/*══════════════════════════════| • • • • • • • • - INSERT:0 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   :  ║   ,  ║  .   ║  P   ║  Y   ║       ║   F  ║   G  ║   C  ║   R  ║   L  ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   A  ║   O  ║  E   ║  U   ║  I   ║       ║   D  ║   H  ║   T  ║   N  ║   S  ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   "  ║   Q  ║  J   ║  K   ║  X   ║       ║   B  ║   M  ║   W  ║   V  ║   Z  ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║LSFT/║       ║NAVGT║NUMBR║                                ║
                               ║MACRO║ TAB ║       ║/SPCE║/LEAD║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_INSERT] = LAYOUT(/* INSERT :0 ════════════════════════════════════════════════════════════╣        */
                    CLN_, CM_, DT_, P_,  Y_,        F_, G_, C_, R_, L_,
                    A_,   AO_, GE_, CU_, I_,        D_, H_, T_, N_, S_,
                    DQ_,  Q_,  J_,  K_,  X_,       RW_B, M_, W_, V_, Z_,

                               MACRO, LS_,          NV_SPC, NUMBR

    ),


/*══════════════════════════════| • • • • • • • - NAVIGATE:1 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║ BACK ║ PTAB ║ NTAB ║  FWD ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║   ←  ║   ↓  ║   ↑  ║    → ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║ HOME ║ PTAB ║ NTAB ║  END ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_NAVIGATE] = LAYOUT(/* NAVIGATE :1 ════════════════════════════════════════════════════════╣        */
                    ___, ___, ___, ___, ___,        ___, WBk,   P_TAB, N_TAB, WFwd,
                    ___, ___, ___, ___, ___,        ___, ArL,   ArD,   ArU,   ArR,
                    ___, ___, ___, ___, ___,        ___, HOME,  P_DN,  P_UP,  END,

                                   ___, ___,        FROM, ___

    ),


/*══════════════════════════════| • • • • • • •  - NUMBERS:2 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║P(VAR)║   7  ║   9  ║   9  ║VAR++ ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║   0  ║   4  ║   5  ║   6  ║VAR=1 ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║P(VAR)║   1  ║   2  ║   3  ║VAR-- ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║TO:FN║     ║       ║     ║ FROM║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_NUMBERS] = LAYOUT(/* NUMBERS :2 ══════════════════════════════════════════════════════════╣        */
                ___,  ___,  ___,  ___,  ___,         X_VALU, _7, _8, _9, X_INCR,
                ___,  ___,  ___,  ___,  ___,             _0, _4, _5, _6, X_TARE,
                ___,  ___,  ___,  ___,  ___,         X_VALU, _1, _2, _3, X_DECR,

                                 MO(3), ___,        ___, FROM

    ),


/*══════════════════════════════| • • • • • • • - FUNCTION:3 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║  F12 ║   F7 ║   F9 ║   F9 ║      ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║  F10 ║   F4 ║   F5 ║   F6 ║      ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║  F11 ║   F1 ║   F2 ║   F3 ║      ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║ FROM║     ║       ║     ║FROM ║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_FUNCTION] = LAYOUT(/* FUNCTION :3 ════════════════════════════════════════════════════════╣        */
                    ___, ___, ___, ___, ___,        _F12, _F7, _F8, _F9, ___,
                    ___, ___, ___, ___, ___,        _F10, _F4, _F5, _F6, ___,
                    ___, ___, ___, ___, ___,        _F11, _F1, _F2, _F3, ___,

                                  FROM, ___,        ___, FROM

    ),


/*══════════════════════════════| • • • • • • • •  - MACRO:4 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║  M2  ║  M1  ║      ║       ║      ║      ║      ║      ║      ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║  M2R ║  M1R ║      ║       ║      ║      ║      ║      ║      ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_MACRO] = LAYOUT(/*     MACRO :4 ══════════════════════════════════════════════════════════╣        */
                ___, ___, ___,   ___,   ___,      ___, ___, ___, ___, ___,
                ___, ___, DM_P2, DM_P1, ___,      ___, ___, ___, ___, ___,
                ___, ___, DM_R2, DM_R1, ___,      ___, ___, ___, ___, ___,

                                     FROM, ___, ___, MEDIA

    ),


/*══════════════════════════════| • • • • • • • •  - MEDIA:5 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║  >|| ║  <<  ║  V↑  ║  V↓  ║  >>  ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║     ║     ║       ║     ║ FROM║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_MEDIA] = LAYOUT(/*     MEDIA :5 ══════════════════════════════════════════════════════════╣        */
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,
                     ___, ___, ___, ___, ___,      PLAY, PRV, VDN, VUP, NXT,
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,

                                       ___, ___, ___, FROM

    ),
/*══════════════════════════════════════════════════════════════════════════════════════════════╣           */
/*══════════════════════════════| • • • • • • • • - INVERT:6 |══════════════════════════════════╣
                                                                                                ║
        ╔══════╦══════╦══════╦══════╦══════╗       ╔══════╦══════╦══════╦══════╦══════╗         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   L  ║   R  ║  C   ║  G   ║  F   ║       ║   Y  ║   P  ║   .  ║   ,  ║   :  ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   S  ║   N  ║  T   ║  H   ║  D   ║       ║   I  ║   U  ║   E  ║   O  ║   A  ║         ║
        ╠══════╬══════╬══════╬══════╬══════╣       ╠══════╬══════╬══════╬══════╬══════╣         ║
        ║      ║      ║      ║      ║      ║       ║      ║      ║      ║      ║      ║         ║
        ║   Z  ║   V  ║  W   ║  M   ║  B   ║       ║   X  ║   K  ║   J  ║   Q  ║   "  ║         ║
        ╚══════╩══════╩══════╩══════╩══════╝       ╚══════╩══════╩══════╩══════╩══════╝         ║
                               ╔═════╦═════╗       ╔═════╦═════╗                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ║     ║     ║       ║     ║     ║                                ║
                               ╚═════╩═════╝       ╚═════╩═════╝                                ║
                                                                                                ║        */
    [_INVERT] = LAYOUT(/* INVERT :6 ════════════════════════════════════════════════════════════╣        */

                        L_, R_, C_, G_, F_,        Y_, P_, DT_, CM_, CLN_,
                        S_, N_, T_, H_, D_,        I_, CU_, GE_, AO_, A_,
                        Z_, V_, W_, M_, B_,        X_, K_, J_, Q_, DQ_,
                               ___, ___,            ___, ___

    ),

    [_MOUSE] = LAYOUT(/* _MOUSE :7 ═════════════════════════════════════════════════════════════╣        */
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,
                   ___, BTN2, BTN3, BTN1, ___,     ___, ___, ___, ___, ___,
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,

                                       ___, ___, ___, ___
    ),

    [_RAWHID] = LAYOUT(/* _RAWHID :8 ═══════════════════════════════════════════════════════════╣        */
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,
                   ___, RAW3, RAW2, RAW1, ___,     ___, ___, ___, ___, ___,
                     ___, ___, ___, ___, ___,      ___, ___, ___, ___, ___,

                                       ___, ___, ___, ___
    ),

    [_VIEWING] = LAYOUT(/* VIEWING :9 ════════════════════════════════════════════════════════╣        */
                    ___, ___, ___, ___, ___,        VUP, WBk,   P_TAB, N_TAB, WFwd,
                    ___, ___, ___, ___, ___,        VDN, ArL,   ArD,   ArU,   ArR,
                    ___, ___, ___, ___, ___,        PLAY, CLN_, P_DN,  P_UP,  SCL_,

                                   FROM, FROM,      LS_, MO(7)

    ),

/*══════════════════════════════════════════════════════════════════════════════════════════════╣
                                                                                                ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╣           */
};
/*                                     ,_    /) (\    _,                                        ║
                                        >>  <<,_,>>  <<                                         ║
                                       //   _0.-.0_   \\                                        ║
                                       \'._/       \_.'/                                        ║
                                        '-.\.--.--./.-'                                         ║
                                        __/ : :Y: : \__                                         ║
                                ';,  .-(_| : : | : : |_)-.  ,:'                                 ║
                                  \\/.'  |: : :|: : :|  `.\//                                   ║
                                   (/    |: : :|: : :|    \)                                    ║
                                         |: : :|: : :;                                          ║
                                        /\ : : | : : /\                                         ║
                                       (_/'.: :.: :.'\_)                                        ║
                                        \\  `""`""`  //                                         ║
                                         \\         //                                          ║
                                          ':.     .:'                                           ║
════════════════════════════════════════════════════════════════════════════════════════════════╣
                                                                                                ║
*═══════════════════════════════════════════════════════════════════════════════════════════════╝           */





